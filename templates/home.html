<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="/static/css/styles.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
</head>

<body>
    <div class="home-container">
        <!-- Tombol Logout dan Tema -->
        <div class="header-actions">
            <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
            <button id="theme-toggle" class="btn secondary-button" onclick="toggleTheme()"><i class="fas fa-adjust"></i>
                Toggle Theme</button>
        </div>

        <!-- Heading Utama dengan Ikon -->
        <h1><i class="fas fa-home"></i> Home</h1>

        <!-- Informasi CSV dengan Ikon -->
        <section id="csv-info" class="info-section">
            <h2><i class="fas fa-file-csv"></i> CSV Information</h2>
            <p><strong>Columns:</strong> Date, Time, Appliance, Energy_Consumption, Room, Status, Temperature,
                Weather_Condition, Number_of_People, Activity, Season, Energy_Rating, Usage_Duration, Appliance_Wattage
            </p>
            <p><strong>Example rows:</strong></p>
            <div class="table-container">
                <table class="transparent-table">
                    <thead>
                        <tr>
                            <th><i class="fas fa-calendar-day"></i> Date</th>
                            <th>Time</th>
                            <th>Appliance</th>
                            <th>Energy Consumption</th>
                            <th>Room</th>
                            <th>Status</th>
                            <th>Temperature</th>
                            <th>Weather Condition</th>
                            <th>Number of People</th>
                            <th>Activity</th>
                            <th>Season</th>
                            <th>Energy Rating</th>
                            <th>Usage Duration</th>
                            <th>Appliance Wattage</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>2024-01-01</td>
                            <td>00:00</td>
                            <td><i class="fas fa-temperature-low"></i> Refrigerator</td>
                            <td>1.2</td>
                            <td>Kitchen</td>
                            <td>On</td>
                            <td>5</td>
                            <td>Clear</td>
                            <td>2</td>
                            <td>Sleeping</td>
                            <td>Winter</td>
                            <td>A</td>
                            <td>24</td>
                            <td>150</td>
                        </tr>
                        <tr>
                            <td>2024-01-01</td>
                            <td>09:00</td>
                            <td><i class="fas fa-tv"></i> TV</td>
                            <td>0.8</td>
                            <td>Living Room</td>
                            <td>On</td>
                            <td>4</td>
                            <td>Cloudy</td>
                            <td>4</td>
                            <td>Watching TV</td>
                            <td>Winter</td>
                            <td>B</td>
                            <td>4</td>
                            <td>100</td>
                        </tr>
                        <tr>
                            <td>2024-01-01</td>
                            <td>18:00</td>
                            <td><i class="fas fa-lightbulb"></i> Light</td>
                            <td>0.1</td>
                            <td>Kitchen</td>
                            <td>On</td>
                            <td>4</td>
                            <td>Cloudy</td>
                            <td>4</td>
                            <td>Dinner</td>
                            <td>Winter</td>
                            <td>D</td>
                            <td>2</td>
                            <td>60</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Gambar Dummy untuk Ilustrasi -->
        <div class="image-placeholder">
            <img style="text-align: center; margin-top: 1em;" src="https://picsum.photos/700/200" alt="Sample Image" />
        </div>

        <!-- Formulir Pertanyaan -->
        <section style="margin-top: 3em;" id="question-form-section">
            <form id="question-form">
                <label for="question"><i class="fas fa-question-circle"></i> Ask a question:</label>
                <input type="text" id="question" name="question" placeholder="Enter your question..." required>
                <input type="submit" value="Submit">
            </form>
            <div class="response-section" id="response-section">
                <!-- AI-generated responses will be added here -->
            </div>
        </section>

        <hr>

        <!-- Rekomendasi Penghematan Energi dengan Ikon -->
        <section id="recommendation-section">
            <h2><i class="fas fa-lightbulb"></i> Energy Saving Recommendations</h2>
            <form id="recommend-form">
                <label for="text"><i class="fas fa-comment-dots"></i> Describe your situation:</label>
                <input type="text" id="text" name="text" placeholder="Describe your situation..." required>
                <input type="submit" value="Get Recommendations">
            </form>
            <div id="recommendations-list">
                <!-- Recommendations will be dynamically added here -->
            </div>
        </section>
    </div>

    <script>
        document.getElementById('question-form').addEventListener('submit', function (event) {
            event.preventDefault();
            const question = document.getElementById('question').value;

            fetch('/ask', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ question })
            })
                .then(response => response.json())
                .then(data => {
                    const responseSection = document.getElementById('response-section');

                    const card = document.createElement('div');
                    card.className = 'card';

                    const answerHeading = document.createElement('h3');
                    answerHeading.textContent = 'Answer';
                    card.appendChild(answerHeading);

                    const answerPara = document.createElement('p');
                    const friendly_answer = `Answer ${data.answer}\t ,Aggregator ${data.aggregator}`
                    answerPara.textContent = friendly_answer;
                    card.appendChild(answerPara);

                    responseSection.appendChild(card);
                })
                .catch(error => console.error('Error:', error));
        });

        document.getElementById('recommend-form').addEventListener('submit', function (event) {
            event.preventDefault();
            const text = document.getElementById('text').value;

            fetch('/recommend', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ text })
            })
                .then(response => response.json())
                .then(data => {
                    const recommendationsList = document.getElementById('recommendations-list');

                    const recommendationDiv = document.createElement('div');
                    recommendationDiv.classList.add('card');

                    const inputPara = document.createElement('p');
                    inputPara.classList.add('recommendation-input');
                    inputPara.innerHTML = `<strong>Input:</strong> ${data.input}`;
                    recommendationDiv.appendChild(inputPara);

                    const recommendationPara = document.createElement('div');
                    recommendationPara.classList.add('recommendation-output');
                    const recommendationText = data.recommendation.Parts.join(" ");
                    recommendationPara.innerHTML = convertMarkdownToHTML(recommendationText);
                    recommendationDiv.appendChild(recommendationPara);

                    recommendationsList.appendChild(recommendationDiv);
                })
                .catch(error => console.error('Error:', error));
        });

        function convertMarkdownToHTML(markdown) {
            const rules = [
                { regex: /###### (.*$)/gim, replacement: '<h6>$1</h6>' },
                { regex: /##### (.*$)/gim, replacement: '<h5>$1</h5>' },
                { regex: /#### (.*$)/gim, replacement: '<h4>$1</h4>' },
                { regex: /### (.*$)/gim, replacement: '<h3>$1</h3>' },
                { regex: /## (.*$)/gim, replacement: '<h2>$1</h2>' },
                { regex: /# (.*$)/gim, replacement: '<h1>$1</h1>' },
                { regex: /\*\*(.*)\*\*/gim, replacement: '<strong>$1</strong>' },
                { regex: /\*(.*)\*/gim, replacement: '<em>$1</em>' },
                { regex: /\n$/gim, replacement: '<br />' },
                { regex: /^\> (.*$)/gim, replacement: '<blockquote>$1</blockquote>' },
                { regex: /\n\*(.*)/gim, replacement: '<ul>\n<li>$1</li>\n</ul>' },
                { regex: /\n[0-9]+\.(.*)/gim, replacement: '<ol>\n<li>$1</li>\n</ol>' },
            ];
            let html = markdown;
            rules.forEach(rule => {
                html = html.replace(rule.regex, rule.replacement);
            });
            return html.trim();
        }

        function logout() {
            window.location.href = '/logout';
        }
    </script>

    <script src="/static/js/script.js"></script>
</body>

</html>